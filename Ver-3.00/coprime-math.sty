%%================================================================================================================

%% This package has a copywrite to Coprime --- Ver 1.00
%% Email Address : almagest0328@gmail.com
%
%% coprime-math Package, First Release Date : 2019/09/28
%
%% Ver 1.00 : 19/09/28 --- To manage simply, this package was made
%% Ver 1.01 : 19/11/06 --- Both XeTeX and LuaTeX can be used

%%================================================================================================================

% LaTeX Format and Define a Package Name
\NeedsTeXFormat{LaTeX2e}
\RequirePackage{expl3, xparse, l3keys2e}
\ProvidesExplPackage {coprime-math} {2019/11/06} {1.01} {Copywrite to Coprime}

% Declare Options
\keys_define:nn {coprime-math-options}
{
    nobreak .bool_set:N = \g_nobreak_math_bool,
    stix .bool_set:N = \g_stix_math_bool,
}
\ProcessKeysOptions{coprime-math-options}

% Raise Error when the tex engine is not either pdf or lua
\sys_if_engine_ptex:T
{
    \ClassError{coprime}{Use~'pdftex',~'xetex',~or~'luatex'~engine}{}
}
\sys_if_engine_uptex:T
{
    \ClassError{coprime}{Use~'pdftex',~'xetex',~or~'luatex'~engine}{}
}

%Import Basic math Packages
\RequirePackage{amsmath, amssymb, amsthm, amsfonts}
\RequirePackage{mathrsfs, euscript}
\RequirePackage{mathtools}
\RequirePackage{scalerel}
\RequirePackage{fouridx}
\RequirePackage{centernot}
\RequirePackage{relsize}
\RequirePackage{etoolbox}

% Aligned math break
\bool_if:NF \g_nobreak_math_bool
{
    \allowdisplaybreaks
}

% Math Commands
% Use DeclareMathOperator simply
\let\DMO\DeclareMathOperator

% Use \largecomp to display the original complement
\let\largecomp\complement

%% Math Settings
% Math Symbol
\sys_if_engine_pdftex:TF
{
    \bool_if:NTF \g_stix_math_bool
    {%
	\RequirePackage[upint]{stix2}
	\let\oldemptyset\emptyset
	\let\emptyset\varnothing
	\renewenvironment{cases}{\left\{\begin{matrix}}{\end{matrix}\right.}
    }
    {%
	\DMO*{\bigcupdot}
	{%
	    \ooalign{\hfil$\displaystyle\bigcup$\hfil\cr%
	    \hfil\raise-.4ex\hbox{\larger[3]$\cdot$}\raise-1.17ex\hbox{}\hfil\cr}
	}
	\newcommand{\cupdot}{\ooalign{\hfil$\cup$\hfil\cr\hfil$\cdot$\hfil\cr}}
	\DMO{\nullint}{\scalerel*[0.1pt]{\phantom{|}}{\int}}
	\newcommand{\upint}{\overline{\int}\hskip-1.5pt\nullint}
	\newcommand{\lowint}{\underline{\int}\hskip-1.5pt\nullint}
	\RequirePackage{dsfont}
	\let\oldemptyset\emptyset
	\let\emptyset\varnothing
    }
}
{
    \bool_if:NTF \g_stix_math_bool
    {
	\RequirePackage{fontspec}
	\RequirePackage[math-style=TeX]{unicode-math}
	\setmainfont{STIX Two Text}
	\setmathfont[StylisticSet=8]{STIX Two Math}
	\renewenvironment{cases}{\left\{\begin{matrix}}{\end{matrix}\right.}
    }
    {
	\DMO*{\bigcupdot}
	{%
	    \ooalign{\hfil$\displaystyle\bigcup$\hfil\cr%
	    \hfil\raise-.4ex\hbox{\larger[3]$\cdot$}\raise-1.17ex\hbox{}\hfil\cr}
	}
	\newcommand{\cupdot}{\ooalign{\hfil$\cup$\hfil\cr\hfil$\cdot$\hfil\cr}}
	\DMO{\nullint}{\scalerel*[0.1pt]{\phantom{|}}{\int}}
	\newcommand{\upint}{\overline{\int}\hskip-1.5pt\nullint}
	\newcommand{\lowint}{\underline{\int}\hskip-1.5pt\nullint}
	\RequirePackage{mathrsfs, euscript, dsfont}
	\let\oldemptyset\emptyset
	\let\emptyset\varnothing
    }
}

\newcommand{\cl}[1]{\overline{#1}}
\newcommand{\@proved}{\ifmmode \tag*{$\Box$}\else\null\hfill $\Box$\fi}
\newcommand{\@@proved}{\ifmmode \tag*{$\blacksquare$}\else\null\hfill $\blacksquare$\fi}
\newcommand{\@@@proved}{\ifmmode \tag*{$\blacklozenge$}\else\null\hfill $\blacklozenge$\fi}
\NewDocumentCommand{\proved}{ss}
{%
    \IfBooleanTF{#1}
    {%
	\IfBooleanTF{#2}
	{%
	    \@@@proved
	}
	{%
	    \@@proved
	}
    }
    {%
	\@proved
    }
}
\renewcommand{\complement}[1]{{#1}^{\mathsf{c}}}
\newcommand{\comp}[1]{{#1}^{\mathsf{c}}}
\newcommand{\contradiction}{\ifmmode(\downzigzagarrow)\else$(\downzigzagarrow)$\fi}

% Math Font Commands
\protected\def\rm#1{\ifmmode\mathrm{#1}\else\textrm{#1}\fi}
\protected\def\sf#1{\ifmmode\mathsf{#1}\else\textsf{#1}\fi}
\protected\def\tt#1{\ifmmode\mathtt{#1}\else\texttt{#1}\fi}
\protected\def\bf#1{\ifmmode\mathbf{#1}\else\textbf{#1}\fi}
\protected\def\md#1{\ifmmode\text{\mdseries #1}\else{\mdseries #1}\fi}
\protected\def\lf#1{\ifmmode\text{\lfseries #1}\else{\lfseries #1}\fi}
\protected\def\it#1{\ifmmode\text{\itshape #1}\else{\itshape #1}\fi}
\protected\def\up#1{\ifmmode\text{\upshape #1}\else{\upshape #1}\fi}
\protected\def\sl#1{\ifmmode\text{\slshape #1}\else{\slshape #1}\fi}
\protected\def\sc#1{\ifmmode\text{\scshape #1}\else{\scshape #1}\fi}

\newcommand{\es}[1]{\EuScript{#1}}
\newcommand{\scr}[1]{\mathscr{#1}}
\renewcommand{\cal}[1]{\mathcal{#1}}
\renewcommand{\frak}[1]{\mathfrak{#1}}
\newcommand{\ds}[1]{\mathds{#1}}
\newcommand{\bbb}[1]{%
    \bool_if:NTF \g_stix_math_bool
    {%
	\mathbb{#1}
    }
    {%
	\ifx 1#1
	    \ds{1}
	\else
	    \mathbb{#1}
	\fi
    }
}

% Define Simple Font Load
\def\do#1{%
    \@namedef{#1b}{{\ensuremath{\bbb{#1}}}}
    \@namedef{#1c}{{\ensuremath{\mathcal{#1}}}}
    \@namedef{#1s}{{\ensuremath{\mathscr{#1}}}}
    \@namedef{#1e}{{\ensuremath{\EuScript{#1}}}}
    \@namedef{#1f}{{\ensuremath{\mathfrak{#1}}}}
}
\docsvlist{A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z}

% Define the set of the number system
\let\N\Nb \let\Z\Zb \let\Q\Qb \let\R\Rb \let\@C\Cb

% Redefine the \not command
\tl_new:N \l_is_not_endmath_tl
\sys_if_engine_pdftex:T
{%
    \let\oldnot\not
    \newcommand{\nulln@t}{\oldnot\null}
    \newcommand{\n@t}[1]{%
	\tl_set:Nn \l_is_not_endmath_tl {#1}
	\tl_if_in:NnTF \l_is_not_endmath_tl {^^24}
	{%
	    \nulln@t^^24
	}
	{%
	    \centernot{#1}
	}
    }
    \let\not\n@t
}

% Define the \Matrix command
\tl_new:N \l_change_cs_tl
\tl_new:N \l_type_matrix_tl

\NewDocumentCommand{\Matrix}{soom}{%
    \tl_set:Nn \l_change_cs_tl {#4}
    \tl_replace_all:Nnn \l_change_cs_tl {,} {&}
    \sys_if_engine_xetex:TF
    {%
	\tl_replace_all:Nnn \l_change_cs_tl {;} {\\[6pt]}
    }
    {%
	\tl_replace_all:Nnn \l_change_cs_tl {;} {\\}
    }
    \IfNoValueTF{#3}
    {%
	\IfNoValueTF{#2}
	{\tl_set:Nn \l_type_matrix_tl {p}}
	{%
	    \tl_if_in:nnTF {#2} {n}
	    {%
		\tl_set:Nn \l_type_matrix_tl {}
	    }
	    {%
		\tl_set:Nn \l_type_matrix_tl {#2}
	    }
	}
	\IfBooleanTF{#1}
	{%
	    \tl_put_right:Nn \l_type_matrix_tl {smallmatrix*}
	    \begin{\tl_use:N \l_type_matrix_tl}[c]
		\tl_use:N \l_change_cs_tl
	    \end{\tl_use:N \l_type_matrix_tl}
	}
	{%
	    \tl_put_right:Nn \l_type_matrix_tl {matrix}
	    \begin{\tl_use:N \l_type_matrix_tl}\
		\tl_use:N \l_change_cs_tl
	    \end{\tl_use:N \l_type_matrix_tl}
	}
    }
    {%
	\tl_if_empty:nTF {#2}
	{%
	    \def\LeftDelimeter{(}
	}
	{%
	    \def\LeftDelimeter{#2}
	}
	\tl_if_empty:nTF {#3}
	{%
	    \def\RightDelimeter{)}
	}
	{%
	    \IfNoValueTF{#3}
	    {%
		\def\RightDelimeter{)}
	    }
	    {%
		\def\RightDelimeter{#3}
	    }
	}
	\IfBooleanTF{#1}
	{%
	    \left\LeftDelimeter\begin{smallmatrix*}[c]
		\tl_use:N \l_change_cs_tl
	    \end{smallmatrix*}\right\RightDelimeter
	}
	{%
	    \left\LeftDelimeter\begin{matrix}
		\tl_use:N \l_change_cs_tl
	    \end{matrix}\right\RightDelimeter
	}
    }
}

% Other useful commands
\NewDocumentCommand{\idx}{mm}{\idx@Assist{#1,#2}}
\NewDocumentCommand{\idx@Assist}{>{\SplitArgument{4}{,}}m}{%
    \idx@@Assist #1
}
\NewDocumentCommand{\idx@@Assist}{mmmmm}{%
    \fourIdx{#1}{#3}{#2}{#4}{#5}
}
\NewDocumentCommand{\converge}{O{}}{%
    \IfNoValueTF{#1}
    {\mbox{}\overset{}{\rightarrow}}
    {\mbox{}\overset{\raisebox{-1.7pt}{\scriptsize${#1}$}}{\rightarrow}}
}
\def\uniform{\rightrightarrows}
\def\defeq{\coloneqq}
\let\normaleq\trianglelefteq
\let\normal\vartriangleleft
\let\oldC\C
\let\C\@C
